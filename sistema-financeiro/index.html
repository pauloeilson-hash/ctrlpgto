<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Controle de Pagamentos - Sistema Online</title>
    
    <!-- Bibliotecas externas -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<!-- Header Fixo - VERS√ÉO COM BOT√ÉO DO MODO ESCURO -->
<header style="position: fixed; 
               top: 0; 
               left: 0; 
               width: 100%; 
               background: #343a40; 
               padding: 15px 20px; 
               z-index: 1000;
               box-shadow: 0 2px 5px rgba(0,0,0,0.1);
               display: flex;
               align-items: center;
               justify-content: space-between;">
    
    <div style="display: flex; align-items: center; gap: 15px;">
        <button onclick="voltarAoMenu()"
                style="background: #6c757d; 
                       color: white; 
                       border: none; 
                       padding: 8px 15px; 
                       border-radius: 4px; 
                       cursor: pointer;
                       font-size: 14px;">
            ‚¨ÖÔ∏è Voltar ao Menu Principal
        </button>
        
        <span style="color: white; font-weight: bold;">
            <!-- T√≠tulo din√¢mico -->
            <span id="nome-sistema">üìä Controle de Pagamentos</span>
        </span>
    </div>

    <!-- BOT√ÉO DO MODO ESCURO NO HEADER -->
    <button id="btn-toggle-darkmode" class="darkmode-toggle" title="Alternar modo escuro/claro"
            style="background: #6c757d; 
                   color: white; 
                   border: none; 
                   padding: 8px 12px; 
                   border-radius: 4px; 
                   cursor: pointer;
                   font-size: 14px;">
        üåô
    </button>
</header>

<!-- Adicione margem ao conte√∫do para n√£o ficar atr√°s do header fixo -->
<div style="margin-top: 70px;">
   <!--<div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: wrap; gap: 10px;">
        <h1 style="margin: 0;">Controle de Pagamentos</h1>
<!--  REMOVIDO      <button id="btn-toggle-darkmode" class="darkmode-toggle" title="Alternar modo escuro/claro">
            üåô
        </button>    -->
    </div>
    <!-- ... resto do c√≥digo continua igual ... -->
</div>

<!-- Registro de Pagamento - VERS√ÉO CORRIGIDA -->
<div class="card">
    <strong>Registrar Pagamento</strong>
    <div class="grid" style="margin-top:8px">
        <div>
            <label for="input-nome">Nome</label>
            <input id="input-nome" type="text" placeholder="Ex.: Jo√£o Silva" list="datalist-nomes" autocomplete="off">
            <datalist id="datalist-nomes"></datalist>
        </div>
        <div><label for="input-data">Data</label><input id="input-data" type="date"></div>
        <div><label for="input-valor">Valor (R$)</label><input id="input-valor" type="number" step="0.01" placeholder="1000.00"></div>
        <div><label for="input-historico">Hist√≥rico</label><input id="input-historico" type="text" placeholder="Descri√ß√£o do pagamento"></div>
        <div>
            <label for="input-status">Status</label>
            <select id="input-status">
                <option value="pendente">‚è≥ Pendente</option>
                <option value="efetuado">‚úÖ Efetuado</option>
            </select>
        </div>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px">
        <button id="btn-registrar">Registrar</button>
        <button id="btn-limpar" class="secondary">Limpar</button>
        <!--<button id="btn-save-close" class="danger" title="Gera backup CSV/XLSX e fecha o programa">Salvar e Fechar</button>-->
        <div style="margin-left:auto"><small class="note">Dados salvos localmente no navegador (localStorage).</small></div>
    </div>
</div>
<!-- Backup e Restaura√ß√£o -->
<div class="card">
    <strong>üíæ Backup e Restaura√ß√£o</strong>
    <div style="margin-top:8px">
        <div style="display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
            <!-- Backup Local -->
            <button id="backup-json-btn" class="success">üíæ Backup JSON</button>
            <button id="restore-json-btn" class="secondary">üì• Restaurar JSON</button>
            
            <div style="margin-left: auto;">
                <small class="note" id="backup-status">Backup em formato JSON</small>
            </div>
        </div>
        
        <!-- Informa√ß√µes sobre as op√ß√µes -->
        <div style="margin-top: 10px; padding: 8px; background: #f8f9fa; border-radius: 4px;">
            <small style="color: #666;">
                <strong>üí° Backup em JSON:</strong><br>
                ‚Ä¢ Salva todos os dados em formato JSON<br>
                ‚Ä¢ Mant√©m metadados e estrutura completa<br>
                ‚Ä¢ Ideal para backup e migra√ß√£o de dados
            </small>
        </div>
    </div>
</div>

<!-- Filtros -->
<div class="card">
    <strong>Filtros</strong>
    <div class="grid" style="margin-top:8px">
        <div>
            <label for="filtro-nome">Nome (selecionar)</label>
            <select id="filtro-nome" style="width:100%">
                <option value="">-- Todos --</option>
            </select>
        </div>
        <div><label for="filtro-di">Data inicial</label><input id="filtro-di" type="date"></div>
        <div><label for="filtro-df">Data final</label><input id="filtro-df" type="date"></div>
        <div>
            <label for="filtro-status">Status</label>
            <select id="filtro-status" style="width:100%">
                <option value="">-- Todos --</option>
                <option value="pendente">Pendente</option>
                <option value="efetuado">Efetuado</option>
            </select>
        </div>
    </div>
    
    <!-- Filtro Avan√ßado -->
    <div style="margin-top:12px; padding-top:12px; border-top:1px solid #eee;">
        <strong>Filtro Avan√ßado</strong>
        <div style="margin-top:8px">
            <label for="filtro-historico">Buscar no Hist√≥rico</label>
            <input id="filtro-historico" type="text" placeholder="Digite palavras-chave (n√£o diferencia mai√∫sculas/min√∫sculas)" style="width:100%">
        </div>
    </div>
    
    <div style="margin-top:10px;display:flex;gap:8px">
        <button id="btn-aplicar-filtros">Aplicar Filtros</button>
        <button id="btn-limpar-filtros" class="secondary">Limpar Filtros</button>
    </div>
</div>

       <!-- Gr√°ficos -->
<div class="card" id="card-graficos">
    <strong>Gr√°ficos</strong>
    <div class="charts">
        <div><canvas id="chart-nomes" height="300" role="img" aria-label="Gr√°fico de totais por nome"></canvas></div>
        <div><canvas id="chart-meses" height="300" role="img" aria-label="Gr√°fico de totais por m√™s"></canvas></div>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px">
        <!-- REMOVIDO: <button id="btn-atualizar-graficos">Atualizar Gr√°ficos (com filtros)</button> -->
        <button id="btn-relatorio-mes" class="secondary">Relat√≥rio (PDF)</button>
        <button id="btn-relatorio-ano" class="secondary">Relat√≥rio Anual (PDF)</button>
        <button id="btn-reset" class="secondary" style="margin-left:auto">Resetar todos os dados</button>
    </div>
</div>

<!-- Registros (colaps√°vel) - VERS√ÉO SIMPLIFICADA -->
<div class="card" id="card-registros-externo" style="margin-top:0">
    <div style="display:flex;align-items:center">
        <strong>Registros</strong>
        <button type="button" id="btn-toggle-registros" class="collapse-btn" aria-expanded="true" style="margin-left:18px">
            <span id="btn-toggle-text">Recolher</span>
        </button>
        <div class="right controls">
            <!-- Controles de sele√ß√£o m√∫ltipla SIMPLIFICADOS -->
            <div id="selection-controls" style="display:none; align-items:center; gap:8px; margin-right: 16px;">
                <span id="selected-count" style="font-size:14px; color:#666;"></span>
                <!-- REMOVIDOS: btn-marcar-todos e btn-desmarcar-todos -->
                <button id="btn-marcar-pendente" class="warning" title="Marcar como Pendente">‚è≥ Pendente</button>
                <button id="btn-marcar-efetuado" class="success" title="Marcar como Efetuado">‚úÖ Efetuado</button>
            </div>
            <button id="btn-export-csv" class="secondary">Exportar CSV (filtrados)</button>
            <button id="btn-export-xlsx" class="secondary">Exportar XLSX (filtrados)</button>
            <label style="margin-left:8px">
                <input id="file-import" type="file" accept=".csv" style="display:none">
                <button id="btn-import-csv" class="secondary">Importar CSV</button>
            </label>
        </div>
    </div>
    <div id="card-registros-collapsible" class="card-collapsible">
        <div class="table-wrap">
            <table id="tbl-registros" role="grid" aria-label="Lista de pagamentos">
                <thead>
                    <tr>
                        <th style="width: 40px;">
                            <input type="checkbox" id="select-all" title="Selecionar todos">
                        </th>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Data</th>
                        <th style="text-align:right">Valor (R$)</th>
                        <th>Hist√≥rico</th>
                        <th>Status</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="summary" id="resumo-total">Total: R$ 0,00</div>
    </div>
</div>
        <!-- Di√°logo de restaura√ß√£o de backup -->
        <div id="backup-restore-dialog" style="display:none;">
            <div id="backup-restore-content">
                <h2>Restaurar backup?</h2>
                <p>Deseja carregar um backup para restaurar os registros anteriores?</p>
                <input id="restore-file-input" type="file" accept=".csv,.xlsx">
                <div style="margin-top:12px">
                    <button id="btn-restore-ok">Restaurar backup</button>
                    <button id="btn-restore-cancel" class="secondary">N√£o restaurar</button>
                </div>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div id="toast-container" class="toast-container"></div>
    </div>

<!-- Scripts locais NA ORDEM CORRETA -->
    <script src="js/utils.js"></script>
    <script src="js/eventBus.js"></script>
    <script src="js/dataManager.js"></script>
    <script src="js/exportManager.js"></script>
<!-- REMOVER   <script src="js/googleDriveManager.js"></script>  -->
    <script src="js/darkModeManager.js"></script>
    <script src="js/uiComponents.js"></script>
    
    <!-- Script de inicializa√ß√£o -->
    <script>
        console.log('üîç Verificando depend√™ncias...');
        
        function checkDependencies() {
            const deps = ['Utils', 'eventBus', 'dataManager', 'exportManager', 'darkModeManager'];
            const missing = deps.filter(dep => !window[dep]);
            
            if (missing.length > 0) {
                console.error('‚ùå Depend√™ncias faltantes:', missing);
                return false;
            }
            
            console.log('‚úÖ Todas as depend√™ncias carregadas');
            return true;
        }

        // Aguarda um pouco e tenta inicializar
        setTimeout(() => {
            if (!checkDependencies()) {
                console.error('‚ùå N√£o foi poss√≠vel carregar todas as depend√™ncias');
                return;
            }
            
            // Carrega o app.js dinamicamente
            const script = document.createElement('script');
            script.src = 'js/app.js';
            script.onload = () => {
                console.log('‚úÖ app.js carregado');
                if (typeof PagamentosApp !== 'undefined') {
                    const app = new PagamentosApp();
                    app.initialize();
                    window.app = app;
                    console.log('üéâ Aplica√ß√£o inicializada!');
                } else {
                    console.error('‚ùå PagamentosApp n√£o definido');
                }
            };
            script.onerror = () => console.error('‚ùå Erro ao carregar app.js');
            document.head.appendChild(script);
        }, 100);
    </script>

    </div>

<script>
function voltarAoMenu() {
    // Navega√ß√£o inteligente que funciona em qualquer ambiente
    if (window.location.pathname.includes('/sistema-financeiro/') || 
        window.location.pathname.includes('/sistema-combustiveis/')) {
        window.location.href = '../index.html';
    } else {
        window.location.href = './index.html';
    }
}

// Opcional: Detecta qual sistema est√° rodando
if (window.location.pathname.includes('combustiveis') || 
    document.title.includes('Combust√≠vel')) {
    document.getElementById('nome-sistema').textContent = 'Controle de Combust√≠veis';
}
</script>
</body>
</html>